<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Cabeçalho mantido como está -->
</head>
<body>
  <!-- Conteúdo mantido -->

  <script>
    // Firebase já inicializado
    let routers = [];
    let isAdmin = false;
    let adminCredentials = {
      email: "admin@monitor.com",
      password: "cgrplena@2025!"
    };

    let routersRef;
    let auth;

    document.addEventListener('DOMContentLoaded', () => {
      routersRef = firebase.ref(firebase.database, 'routers');
      auth = firebase.auth;

      firebase.onValue(routersRef, (snapshot) => {
        const data = snapshot.val();
        routers = data ? Object.entries(data).map(([key, value]) => ({ id: key, ...value })) : [];
        renderRouters();
      });

      init();
    });

    function saveData(router) {
      if (router.id) {
        const routerRef = firebase.ref(firebase.database, `routers/${router.id}`);
        firebase.set(routerRef, router);
      }
    }

    confirmAddRouterBtn.addEventListener('click', () => {
      const name = routerNameInput.value.trim();
      const ssid = routerSSIDInput.value.trim();
      const password = routerPasswordInput.value.trim();
      const status = routerStatusInput.checked;

      if (name && ssid) {
        const newRouter = {
          name,
          ssid,
          password,
          status,
          lastUpdate: new Date().toISOString()
        };

        const newRef = firebase.push(routersRef);
        firebase.set(newRef, newRouter).then(() => {
          addRouterModal.classList.add('hidden');
        });
      } else {
        showFeedback('Por favor, preencha pelo menos o nome e o SSID do roteador.', 'red');
      }
    });

    function addEventListeners() {
      document.querySelectorAll('.status-toggle').forEach(toggle => {
        toggle.addEventListener('change', function () {
          const id = this.dataset.id;
          const router = routers.find(r => r.id === id);
          if (router) {
            router.status = this.checked;
            router.lastUpdate = new Date().toISOString();
            saveData(router);
          }
        });
      });

      document.querySelectorAll('.ssid-input').forEach(input => {
        input.addEventListener('change', function () {
          const id = this.dataset.id;
          const router = routers.find(r => r.id === id);
          if (router) {
            router.ssid = this.value;
            router.lastUpdate = new Date().toISOString();
            saveData(router);
          }
        });
      });

      document.querySelectorAll('.password-input').forEach(input => {
        input.addEventListener('change', function () {
          const id = this.dataset.id;
          const router = routers.find(r => r.id === id);
          if (router) {
            router.password = this.value;
            router.lastUpdate = new Date().toISOString();
            saveData(router);
          }
        });
      });

      document.querySelectorAll('.delete-router-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          const id = this.dataset.id;
          if (confirm('Deseja remover este roteador?')) {
            const routerRef = firebase.ref(firebase.database, `routers/${id}`);
            firebase.remove(routerRef);
          }
        });
      });
    }
  </script>
</body>
</html>
